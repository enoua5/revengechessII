<!DOCTYPE html>
<html>
  <head>
    <title>Revenge Chess</title>
    <style id = "setable_styles">
      :root
      {
        --black-square-color: #09a;
        --white-square-color: #acf;
        --selected-black-color: #f0f;
        --selected-white-color: #808;
        --possible-move-color: #aaaa;
        --respawn-point-color: #f44a;
        --prev-move-color: #cc4;
      }
    </style>
    <link href="style.css" rel="stylesheet"/>
    <script src = "src/util.js"></script>
    <script src = "src/board.js"></script>
    <script src = "src/infopane.js"></script>
    <script>
      function l(what){return document.getElementById(what)}
      
      var Settings = {
        whiteOnTop: false // TODO not how this will work in the end
      }
      
      var Game = {
        game: null,
        engine: null
      }
      
      var Module = {
        onRuntimeInitialized: function() {
          Game.game = new Module.Game();
          Game.engine = new Module.Engine();
          dispboard(Game.game.board);
        }
      };
    
      function onload()
      {
        for(let y = 7; y >= 0; y--)
        {
          for(let x = 0; x < 8; x++)
          {
            let s = document.createElement("div");
            s.classList.add("square");
            s.id = "square_"+numCoordToString(x,y);
            let color = (x+y)%2 == 1 ? "white" : "black";
            s.classList.add(color+"_square");
            s.onclick=(e)=>{squareClicked(e,s)}
            
            s.ondragstart=(e)=>{squareClicked(e,s)}
            s.ondrop=(e)=>{squareClicked(e,s)}
            s.ondragend=droppedOutside;
            s.ondragenter=(e)=>{e.preventDefault()}
            s.ondragover=(e)=>{e.preventDefault()}
            
            s.onmouseenter=(e)=>{squareHovered(e,s)}
            s.onmouseleave=(e)=>{squareUnhovered(e,s)}
            //tr.appendChild(td);
          l("board").appendChild(s);
          }
        }
        
        var prevFrameWindowSize = {
          width: null,
          height: null,
          twoFrames: false
        };
        
        setInterval(()=>{
          // if the window has not been resized in the last two frames, do nothing.
          if(prevFrameWindowSize.width == window.innerWidth
            && prevFrameWindowSize.height == window.innerHeight)
          {
            if(prevFrameWindowSize.twoFrames)
              return;
            prevFrameWindowSize.twoFrames = true;
          }
          else
          {
            prevFrameWindowSize.twoFrames = false;
          }
          
          prevFrameWindowSize.width = window.innerWidth;
          prevFrameWindowSize.height = window.innerHeight;
          
          
        
          let ratio = l("container").clientWidth/l("container").clientHeight;
          if(ratio == 0) ratio = 1.2;
          ratio = ratio.toFixed(2);
          
          if(window.innerWidth > window.innerHeight*ratio)
          {
            l("container").style.width = (window.innerHeight*ratio*0.95)+"px";
          }
          else
          {
            l("container").style.width = (window.innerWidth*0.95)+"px";
          }
          // fallback for if aspectratio doesn't work
          // breaks if done unconditionally
          if(!("aspectRatio" in document.body.style))
            l("board").style.height = l("board").clientWidth + "px";
        },50);
      }
    </script>
    
    <script src="revengechess.js"></script>
  </head>
  <body onload="onload()">
    <div id="container" style="text-align: center; display: inline-block">
      <div id = "gamearea">
        <div id="option-bar" style="background-color:green"></div>
        <div id="board"></div>
        <div id="game-info" style="background-color:grey">
        
          <div id="piece-stats">
            <div>
              <img id="piece-img" class="info-piece-img"></img>
              <h1 id="piece-name" class="info-piece-name"></h1>
            </div>
            <ul id="capture-list">
            
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
